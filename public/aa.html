<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>tinymce</title>
    <script type="text/javascript" src="javascripts/jquery.min.js"></script>
    <!-- <script type="text/javascript" src="js/tinymce_5.2.1/tinymce/js/tinymce/jquery.tinymce.min.js" referrerpolicy="origin"></script> -->
    <script type="text/javascript" src="javascripts/tinymce/js/tinymce/tinymce.min.js"></script>
    <!-- <script type="text/javascript" src="js/kindeditor/kindeditor-all-min.js"></script>
    <script type="text/javascript" src="js/kindeditor/lang/zh-CN.js"></script> -->
        <style>
            
        </style>
</head>

<body>
    <!-- <textarea id="editor_id" name="content" style="width:700px;height:300px;"></textarea> -->
    <textarea id="mytextarea"></textarea>
    <button onclick="submit()">获取文本</button>
    <button onclick="cd()">cd</button>

    <script>
        function submit(){
            var c = tinyMCE.activeEditor.getContent();
            console.log(c)
        }
        globalcounter = 1;
        tinymce.init({
            selector: '#mytextarea',
            language: "zh_CN",
            menubar: false, //隐藏菜单栏
            branding: false, //隐藏右下角技术支持
            elementpath: false, //隐藏底栏的元素路径
            resize: false, //文本框右下角拖动鼠标调整编辑器高度，默认true
            min_height: 300, //最小高度
            plugins: 'autoresize',
            toolbar: 'undo redo removeformat forecolor backcolor bold italic underline | alignleft aligncenter alignright alignjustify | ' +
                'formatselect | fontselect | fontsizeselect | bullist numlist | blockquote anchor ltrrtl emoticons| restoredraft|' +
                ' hr |link image media | preview searchreplace|table|wordcount code bdmap',
            fontsize_formats: '11px 12px 14px 16px 18px 24px 36px 48px 64px 72px 86px',
            font_formats: '微软雅黑=Microsoft YaHei,Helvetica Neue,PingFang SC,sans-serif;宋体=simsun,serif;仿宋体=FangSong,serif;黑体=SimHei,sans-serif;' +
                'Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;' +
                'Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;' +
                'Terminal=terminal,monaco;Times New Roman=times new roman,times;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats;',
            plugins: 'advlist autolink link preview paste searchreplace table image media lists preview anchor directionality emoticons hr wordcount code bdmap',
            contextmenu: "paste", //右键
            backcolorpicker: ['backcolor_desc', 'mceBackColor'],
            automatic_uploads: true,
            // 图片异步上传处理函数
            // images_upload_handler: function(blobInfo, success, failure){
            //     var xhr, formData;
            //     console.log('blobInfo',blobInfo.blob())
            //     xhr = new XMLHttpRequest();
            //     xhr.withCredentials = false;
            //     xhr.open("POST", "aa");
            //     xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
            //     formData = new FormData();
            //     formData.append("file", blobInfo.blob());
            //     xhr.onload = function(e){
            //             var json;
            //             if (xhr.status != 200) {
            //                 failure('HTTP Error: ' + xhr.status);
            //                 return;
            //             }
            //             json = JSON.parse(this.responseText);
            //             console.log('json---',json)
            //             if (!json || typeof json.location != 'string') {
            //                 failure('Invalid JSON: ' + xhr.responseText);
            //                 return;
            //             }
            //            // success(json.location);
            //             success('http://172.16.0.252:80//uploader/20200319041913906.jpg');
            //     };
            //     //方法用于发送 HTTP 请求。如果是异步请求（默认为异步请求），则此方法会在请求发送后立即返回；如果是同步请求，则此方法直到响应到达后才会返回。
            //     console.log(formData.get('file'));
            //     xhr.send(formData);
            // },
            images_upload_handler: function(blobInfo, success, failure) {
                var formData = new FormData();
                formData.set('files', blobInfo.blob());
                console.log(formData.get('files'))
                $.ajax({
                    url: "/aa/upload",
                    type: "post",
                    data: formData,
                    processData: false,
                    contentType: false,
                    //contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                    success: function(data) {
                        console.log('success',data)
                        success(data.files);
                    },
                    error: function(e) {
                        //alert("图片上传失败");
                        //success('http://172.16.0.252:80//uploader/20200319041913906.jpg');
                    }
                });
            },
            paste_data_images: true,
            paste_preprocess: function(plugin, args) {
                args.content = args.content.replace("<img", "<img id=\" pasted_image_" + parseInt(globalcounter) + "\"");
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200){
                        upload(this.response);
                    }
                };
                xhr.open('GET', args.content.split('"')[3]);
                xhr.responseType = ' blob'; xhr.send(); function upload(BlobFile){ var x=new XMLHttpRequest();
                        x.onreadystatechange=function(){ if( this.readyState==4 && this.status==200 ){ /* 返回的访问链接 */
                        data=this.responseText; console.log('response data: ' + data);
                            id = parseInt(globalcounter++);
                            /* 此处为获取ID为mce_1_ifr的iframe，再获取其下ID为pastes_image_x 的图片，然后更改图片的链接。不同版本下iframe的ID可能会不同，注意观察 */
                            document.getElementById("blog-content_ifr").contentWindow.document.getElementById("pasted_image_" + id).setAttribute("src", data);
                        }
                    };
                    /* 使用post方法，上传的API为http://localhost:8080/uploadimg  */
                    x.open(' POST', '/aaa' ); x.send(BlobFile); 
                } 
            }
        });

        // tinymce.get('mytextarea').setContent('...');
        // var content = tinymce.get('mytextarea').getContent();

        // images_upload_handler: function(blobInfo, success, failure) {
        //     var form = new FormData();
        //     form.append('files', blobInfo.blob(), blobInfo.filename());
        //     $.ajax({
        //         url: "/image/upload",
        //         type: "post",
        //         data: form,
        //         processData: false,
        //         contentType: false,
        //         success: function(data) {
        //             success(data.location);
        //         },
        //         error: function(e) {
        //             alert("图片上传失败");
        //         }
        //         });
        //     }

        //     file_picker_callback: function(callback, value, meta) {

        //                 var input = document.createElement('input');
        //                 input.setAttribute('type', 'file');
        //                 input.onchange = function() {
        //                     var file = this.files[0];
        //                     var form = new FormData();
        //                     form.append("files", file); 
        //                     $.ajax({
        //                         url: "/image/upload",
        //                         type: "post",
        //                         data: form,
        //                         processData: false,
        //                         contentType: false,
        //                         success: function(data) {
        //                             callback(data.location);
        //                         },
        //                         error: function(e) {
        //                             alert("图片上传失败");
        //                         }
        //                     });
        //                 };

        //                 input.click();

        //             }

        // KindEditor.ready(function(K) {
        //     window.editor = K.create('#editor_id');
        // });

        // var options = {
        // cssPath : '/css/index.css',
        // filterMode : true
        // };
        // var editor = K.create('textarea[name="content"]', options);

        function cd(){
            tinyMCE.activeEditor.setContent('设置默认文本');
            $.ajax({
                url: "/aa/cc",
                method: "post",
                data: 'id='+'121212',
                success: function(data) {
                },
                error: function(e) {
                
                }
            });
        }
        // <p><strong>nj<span style="background-color: #e03e2d; color: #ecf0f1;">njnjbb你今</span>年可<span
        //             style="font-size: 24px;"><a id="nj"></a>能尽快</span></strong></p>
        // <p><strong><span style="font-size: 24px;"><img style="display: block; margin-left: auto; margin-right: auto;"
        //                 src="http://172.16.0.252:80//uploader/20200319041913906.jpg" alt="11" width="137"
        //                 height="140" /></span></strong></p>
        // <hr />
        // <p><strong><span style="font-size: 24px;"><video controls="controls" width="300" height="150">
        //                 <source src="http://img.ksbbs.com/asset/Mon_1703/d30e02a5626c066.mp4" type="video/mp4" />
        //                 </video></span></strong></p>
    </script>
</body>

</html>